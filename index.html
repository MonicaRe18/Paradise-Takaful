<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة مؤشرات الأداء الرئيسية للرعاية الاجتماعية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f4f7f9;
        }
        .card {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 5px 15px rgba(0, 39, 74, 0.05);
            border: 1px solid #eef2f6;
            transition: all 0.3s ease;
        }
        .kpi-value {
            font-size: 2.25rem;
            line-height: 1.2;
            font-weight: 800;
        }
        .kpi-label {
            font-weight: 600;
            color: #5a6e82;
        }
        .chart-container {
            height: 350px;
        }
        .geo-chart-container {
            height: 500px;
        }
        .icon-bg {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            width: 60px;
            height: 60px;
        }
        /* Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-on-load {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
        }
    </style>
</head>
<body class="bg-gray-100">

    <main class="p-6 md:p-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 pb-4 border-b animate-on-load">
            <div class="flex items-center">
                <img src="PHOTO/social-takafol-logo-w-removebg-preview.png" alt="شعار المؤسسة العامة للتكافل الاجتماعي" class="h-16 w-auto">
                <div class="mr-4">
                    <h1 class="text-2xl md:text-3xl font-extrabold text-[#005a4e]">لوحة مؤشرات الأداء الرئيسية</h1>
                    <p class="text-gray-500 mt-1">المؤسسة العامة للتكافل الاجتماعي</p>
                </div>
            </div>
            <div class="flex items-center mt-4 md:mt-0">
                 <img src="PHOTO/Microsoft-Dynamics-365-Finance-Operations.png" alt="شعار Microsoft Dynamics 365" class="h-10 w-auto">
            </div>
        </header>

        <!-- Financial Year Bar -->
        <div class="w-full bg-[#005a4e] text-white p-3 rounded-xl text-center mb-6 shadow-lg animate-on-load" style="animation-delay: 0.1s;">
            <h2 class="text-xl font-bold">السنة المالية الحالية: <span id="financial-year"></span></h2>
        </div>

        <!-- KPIs Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8">
            <div class="card p-5 animate-on-load" style="animation-delay: 0.2s;">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">إجمالي المستفيدين</h3>
                        <p class="kpi-value text-[#2e58a6] mt-2" data-value="12450"></p>
                    </div>
                    <div class="icon-bg bg-blue-100">
                        <svg class="w-8 h-8 text-[#2e58a6]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962a3.75 3.75 0 015.958 0m0 0a3.75 3.75 0 01-5.958 0M3 18.75a9.094 9.094 0 013.741-.479 3 3 0 014.682-2.72m-7.5-2.962a3.75 3.75 0 005.958 0m0 0a3.75 3.75 0 00-5.958 0M12 12.75a3 3 0 110-6 3 3 0 010 6z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5 animate-on-load" style="animation-delay: 0.3s;">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">المساعدات المالية</h3>
                        <p class="kpi-value text-[#005a4e] mt-2" data-value="15200000"></p>
                    </div>
                    <div class="icon-bg bg-green-100">
                        <svg class="w-8 h-8 text-[#005a4e]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.75A.75.75 0 013 4.5h.75m0 0a.75.75 0 01.75.75v.75m0 0h-.75A.75.75 0 013 6v-.75m0 0a.75.75 0 01.75-.75h.75M9 4.5v.75A.75.75 0 018.25 6h-.75m0 0v-.75A.75.75 0 018.25 4.5h.75m0 0a.75.75 0 01.75.75v.75m0 0h-.75A.75.75 0 018.25 6v-.75m0 0a.75.75 0 01.75-.75h.75m-6 3.75h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m0 0h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75M9 9.75h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m0 0h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75M7.5 12h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m0 0h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m3-3h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m0 0h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m-9 6.75h15a.75.75 0 010 1.5h-15a.75.75 0 010-1.5z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5 animate-on-load" style="animation-delay: 0.4s;">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">المساعدات العينية</h3>
                        <p class="kpi-value text-[#f9a825] mt-2" data-value="35780"></p>
                    </div>
                    <div class="icon-bg bg-yellow-100">
                        <svg class="w-8 h-8 text-[#f9a825]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 1014.625 7.5H12v-2.625z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25a1.5 1.5 0 01.375 2.954l-8.25 3a1.5 1.5 0 01-1.732-2.102l3.375-9.75a1.5 1.5 0 012.102-1.032l4.125 1.833A1.5 1.5 0 0115 11.25z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5 animate-on-load" style="animation-delay: 0.5s;">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">متوسط دورة الصرف</h3>
                        <p class="kpi-value text-[#d9534f] mt-2">4 <span class="text-2xl font-semibold">أيام</span></p>
                    </div>
                    <div class="icon-bg bg-red-100">
                        <svg class="w-8 h-8 text-[#d9534f]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5 animate-on-load" style="animation-delay: 0.6s;">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">نسبة المستفيدين الجدد</h3>
                        <p class="kpi-value text-[#622f92] mt-2" data-value="0.25" data-format="percent"></p>
                    </div>
                    <div class="icon-bg bg-purple-100">
                        <svg class="w-8 h-8 text-[#622f92]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5 animate-on-load" style="animation-delay: 0.7s;">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">أعلى فئة مساعدة</h3>
                        <p class="kpi-value text-[#c83771]" style="font-size: 1.8rem; line-height: 1.2;">أرامل وأيتام</p>
                    </div>
                    <div class="icon-bg" style="background-color: #fce4ec;">
                        <svg class="w-8 h-8 text-[#c83771]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0l-.07.002-.018.002-.006.001c-.004.001-.007 0-.011.001l.011-.001z" /></svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="card p-5 animate-on-load" style="animation-delay: 0.8s;">
                <h3 class="text-lg font-bold text-gray-800 mb-4">توزيع المساعدات (آخر 6 أشهر)</h3>
                <div class="chart-container">
                    <canvas id="aidDistributionChart"></canvas>
                </div>
            </div>
            <div class="card p-5 animate-on-load" style="animation-delay: 0.9s;">
                <h3 class="text-lg font-bold text-gray-800 mb-4">الأثر الاجتماعي: توزيع المساعدات حسب الفئة</h3>
                <div class="chart-container">
                    <canvas id="socialImpactChart"></canvas>
                </div>
            </div>
             <div class="card p-5 animate-on-load" style="animation-delay: 1s;">
                <h3 class="text-lg font-bold text-gray-800 mb-4">حالة الملفات</h3>
                <div class="chart-container">
                    <canvas id="fileStatusChart"></canvas>
                </div>
            </div>
            <div class="card p-5 animate-on-load" style="animation-delay: 1.1s;">
                <h3 class="text-lg font-bold text-gray-800 mb-4">حالة المستفيدين</h3>
                <div class="chart-container">
                    <canvas id="beneficiaryStatusChart"></canvas>
                </div>
            </div>
            <div class="lg:col-span-2 card p-5 animate-on-load" style="animation-delay: 1.2s;">
                <h3 class="text-lg font-bold text-gray-800 mb-4">توزيع المستفيدين حسب المحافظة</h3>
                <div class="geo-chart-container">
                    <canvas id="geoDistributionChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Professional Color Palette
        const PALETTE = {
            green: '#005a4e', // Unified Green from Solidarity Logo
            yellow: '#f9a825', // From Solidarity Logo
            darkText: '#333333',
            blue: '#2e58a6',   // From Dynamics 365 Logo
            purple: '#622f92', // From Dynamics 365 Logo
            red: '#d9534f',
            magenta: '#c83771',
            lightGrey: '#f4f7f9',
            grey: '#5a6e82'
        };

        // Unified Number Formatter
        function formatNumber(num, formatType = 'default') {
            if (formatType === 'percent') {
                return new Intl.NumberFormat('ar-EG', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 1 }).format(num);
            }
            if (num >= 1000000) {
                return (num / 1000000).toLocaleString('ar-EG', { minimumFractionDigits: 1, maximumFractionDigits: 1 }) + ' مليون';
            }
            if (num >= 1000) {
                return new Intl.NumberFormat('ar-EG').format(num);
            }
            return num;
        }

        // Data for charts
        const aidDistributionData = {
            labels: ['فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو'],
            datasets: [{
                label: 'مساعدات نقدية (مليون ج.م)',
                data: [1.8, 2.1, 2.5, 2.3, 2.8, 3.1],
                backgroundColor: PALETTE.blue,
                borderColor: PALETTE.blue,
                borderWidth: 1,
                borderRadius: 5,
            }, {
                label: 'مساعدات عينية (ألف وحدة)',
                data: [5.2, 8.5, 6.1, 5.8, 7.2, 3.1],
                backgroundColor: PALETTE.yellow,
                borderColor: PALETTE.yellow,
                borderWidth: 1,
                borderRadius: 5,
            }]
        };

        const socialImpactData = {
            labels: ['أرامل وأيتام', 'أمراض مزمنة', 'تمويل مشروعات', 'زواج', 'كوارث ونكبات', 'ذوي الاحتياجات', 'مساعدات عينية'],
            datasets: [{
                label: 'عدد الحالات',
                data: [22, 18, 15, 9, 7, 7, 4],
                backgroundColor: PALETTE.green,
                borderColor: PALETTE.green,
                borderWidth: 1,
                borderRadius: 5,
            }]
        };

        const fileStatusData = {
            labels: ['مقبول', 'تحت البحث', 'جاري استيفاء الأوراق', 'مرفوض'],
            datasets: [{
                label: 'حالة الملفات',
                data: [7500, 2500, 1250, 1200],
                backgroundColor: [PALETTE.green, PALETTE.yellow, PALETTE.blue, PALETTE.red],
                hoverOffset: 4,
                borderColor: '#fff',
                borderWidth: 4,
            }]
        };

        const beneficiaryStatusData = {
            labels: ['متردد', 'جديد', 'متردد جديد'],
            datasets: [{
                label: 'حالة المستفيدين',
                data: [6225, 4980, 1245],
                backgroundColor: [PALETTE.purple, PALETTE.green, PALETTE.blue],
                hoverOffset: 4,
                borderColor: '#fff',
                borderWidth: 4,
            }]
        };

        const geoDistributionData = {
            labels: ['القاهرة', 'الجيزة', 'الشرقية', 'الدقهلية', 'البحيرة', 'الغربية', 'المنوفية', 'أسيوط', 'سوهاج', 'قنا', 'المنيا', 'كفر الشيخ', 'الفيوم', 'بني سويف', 'أسوان', 'الإسماعيلية', 'دمياط', 'بورسعيد', 'السويس', 'مطروح', 'البحر الأحمر', 'الوادي الجديد', 'شمال سيناء', 'جنوب سيناء'],
            datasets: [{
                label: 'عدد المستفيدين',
                data: [4500, 3800, 3200, 2800, 2500, 2200, 1800, 1600, 1400, 1200, 1100, 1000, 900, 800, 700, 600, 500, 400, 300, 250, 200, 150, 100, 50],
                backgroundColor: PALETTE.yellow,
                borderColor: '#d48f21',
                borderWidth: 1,
                borderRadius: 3,
            }]
        };

        // Chart rendering
        window.onload = function() {
            // Set current financial year
            const date = new Date();
            const year = date.getFullYear();
            const month = date.getMonth(); 
            let financialYear;
            if (month >= 6) { 
                financialYear = `${year}/${year + 1}`;
            } else {
                financialYear = `${year - 1}/${year}`;
            }
            document.getElementById('financial-year').textContent = financialYear;
            
            // Format KPI values
            document.querySelectorAll('.kpi-value[data-value]').forEach(el => {
                const value = parseFloat(el.dataset.value);
                const format = el.dataset.format;
                el.textContent = formatNumber(value, format);
            });

            Chart.defaults.font.family = "'Cairo', sans-serif";
            Chart.defaults.font.weight = '600';

            const animationConfig = {
                duration: 1200,
                easing: 'easeInOutQuad',
                delay: (context) => {
                    let delay = 0;
                    if (context.type === 'data' && context.mode === 'default') {
                        delay = context.dataIndex * 30 + context.datasetIndex * 100;
                    }
                    return delay;
                },
            };

            const barChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                animation: animationConfig,
                scales: {
                    y: { grid: { drawBorder: false }, ticks: { font: { size: 12 } } },
                    x: { grid: { display: false }, ticks: { font: { size: 12 } } }
                },
                plugins: {
                    legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'rectRounded', font: { size: 14 } } },
                }
            };
            
            const horizontalBarOptions = {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                animation: animationConfig,
                scales: {
                    y: { grid: { display: false }, ticks: { font: { size: 12 } } },
                    x: { grid: { drawBorder: false }, ticks: { font: { size: 12 } } }
                },
                plugins: {
                    legend: { display: false },
                }
            };

            const doughnutOptions = {
                 responsive: true,
                 maintainAspectRatio: false,
                 cutout: '70%',
                 animation: {
                     animateRotate: true,
                     animateScale: true,
                     duration: 1200
                 },
                 plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { usePointStyle: true, pointStyle: 'rectRounded', font: { size: 14 } }
                    },
                }
            };
            
            new Chart(document.getElementById('aidDistributionChart'), { type: 'bar', data: aidDistributionData, options: barChartOptions });
            new Chart(document.getElementById('socialImpactChart'), { type: 'bar', data: socialImpactData, options: horizontalBarOptions });
            new Chart(document.getElementById('fileStatusChart'), { type: 'doughnut', data: fileStatusData, options: doughnutOptions });
            new Chart(document.getElementById('beneficiaryStatusChart'), { type: 'doughnut', data: beneficiaryStatusData, options: doughnutOptions });
            new Chart(document.getElementById('geoDistributionChart'), { type: 'bar', data: geoDistributionData, options: horizontalBarOptions });
        };
    </script>
</body>
</html>

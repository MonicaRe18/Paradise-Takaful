<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة مؤشرات الأداء الرئيسية للرعاية الاجتماعية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f4f7f9; /* A professional light grey-blue */
        }
        .card {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 5px 15px rgba(0, 39, 74, 0.05);
            border: 1px solid #eef2f6;
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 39, 74, 0.1);
        }
        .kpi-value {
            font-size: 2.25rem; /* 36px */
            line-height: 1.2;
            font-weight: 800;
        }
        .kpi-label {
            font-weight: 600;
            color: #5a6e82;
        }
        .chart-container {
            height: 320px;
        }
        .geo-chart-container {
            height: 664px;
        }
        .icon-bg {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            width: 60px;
            height: 60px;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Main Content -->
    <main class="p-6 md:p-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 pb-4 border-b">
            <div class="flex items-center">
                <img src="PHOTO/social-takafol-logo-w-removebg-preview.png" alt="شعار المؤسسة العامة للتكافل الاجتماعي" class="h-16 w-auto">
                <div class="mr-4">
                    <h1 class="text-2xl md:text-3xl font-extrabold text-[#005a4e]">لوحة مؤشرات الأداء الرئيسية</h1>
                    <p class="text-gray-500 mt-1">المؤسسة العامة للتكافل الاجتماعي</p>
                </div>
            </div>
            <div class="flex items-center mt-4 md:mt-0">
                 <div class="text-left">
                     <p class="flex items-center">
                     <img src="PHOTO/Microsoft-Dynamics-365-Finance-Operations.png" alt="شعار Microsoft Dynamics 365" class="h-8 w-auto">
                 </div>
            </div>
        </header>

        <!-- KPIs Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-6 mb-8">
            <div class="card p-5 bg-[#005a4e] text-white">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label text-green-200">السنة المالية الحالية</h3>
                        <p id="financial-year" class="kpi-value mt-2"></p>
                    </div>
                    <div class="icon-bg bg-white/20">
                        <svg class="w-8 h-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M12 12.75h.008v.008H12v-.008z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">إجمالي المستفيدين</h3>
                        <p class="kpi-value text-[#2e58a6] mt-2">12,450</p>
                    </div>
                    <div class="icon-bg bg-blue-100">
                        <svg class="w-8 h-8 text-[#2e58a6]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962a3.75 3.75 0 015.958 0m0 0a3.75 3.75 0 01-5.958 0M3 18.75a9.094 9.094 0 013.741-.479 3 3 0 014.682-2.72m-7.5-2.962a3.75 3.75 0 005.958 0m0 0a3.75 3.75 0 00-5.958 0M12 12.75a3 3 0 110-6 3 3 0 010 6z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">المساعدات المالية</h3>
                        <p class="kpi-value text-[#008a4c] mt-2">15.2 <span class="text-2xl font-semibold">مليون</span></p>
                    </div>
                    <div class="icon-bg bg-green-100">
                        <svg class="w-8 h-8 text-[#008a4c]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.75A.75.75 0 013 4.5h.75m0 0a.75.75 0 01.75.75v.75m0 0h-.75A.75.75 0 013 6v-.75m0 0a.75.75 0 01.75-.75h.75M9 4.5v.75A.75.75 0 018.25 6h-.75m0 0v-.75A.75.75 0 018.25 4.5h.75m0 0a.75.75 0 01.75.75v.75m0 0h-.75A.75.75 0 018.25 6v-.75m0 0a.75.75 0 01.75-.75h.75m-6 3.75h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m0 0h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75M9 9.75h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m0 0h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75M7.5 12h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m0 0h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m3-3h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m0 0h.75a.75.75 0 01.75.75v.75m0 0h-.75a.75.75 0 01-.75-.75v-.75m-9 6.75h15a.75.75 0 010 1.5h-15a.75.75 0 010-1.5z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">المساعدات العينية</h3>
                        <p class="kpi-value text-[#f9a825] mt-2">35,780</p>
                    </div>
                    <div class="icon-bg bg-yellow-100">
                        <svg class="w-8 h-8 text-[#f9a825]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 1014.625 7.5H12v-2.625z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25a1.5 1.5 0 01.375 2.954l-8.25 3a1.5 1.5 0 01-1.732-2.102l3.375-9.75a1.5 1.5 0 012.102-1.032l4.125 1.833A1.5 1.5 0 0115 11.25z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">متوسط دورة الصرف</h3>
                        <p class="kpi-value text-[#d9534f] mt-2">4 <span class="text-2xl font-semibold">أيام</span></p>
                    </div>
                    <div class="icon-bg bg-red-100">
                        <svg class="w-8 h-8 text-[#d9534f]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">نسبة المستفيدين الجدد</h3>
                        <p class="kpi-value text-[#622f92] mt-2">25%</p>
                    </div>
                    <div class="icon-bg bg-purple-100">
                        <svg class="w-8 h-8 text-[#622f92]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z" /></svg>
                    </div>
                </div>
            </div>
            <div class="card p-5">
                 <div class="flex justify-between items-center">
                    <div>
                        <h3 class="kpi-label">طلبات مكتملة</h3>
                        <p class="kpi-value text-[#2e58a6] mt-2">82%</p>
                    </div>
                    <div class="icon-bg bg-blue-100">
                        <svg class="w-8 h-8 text-[#2e58a6]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 019 9v.375M10.125 2.25A3.375 3.375 0 0113.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 013.375 3.375M9 15l2.25 2.25L15 12" /></svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Column 1 & 2: Main Charts -->
            <div class="lg:col-span-2 space-y-6">
                <div class="card p-5">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">توزيع المساعدات حسب النوع (آخر 6 أشهر)</h3>
                    <div class="chart-container">
                        <canvas id="aidTypeChart"></canvas>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card p-5">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">حالة الملفات</h3>
                        <div class="chart-container">
                            <canvas id="fileStatusChart"></canvas>
                        </div>
                    </div>
                    <div class="card p-5">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">حالة المستفيدين</h3>
                        <div class="chart-container">
                            <canvas id="beneficiaryStatusChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Column 3: Geo Chart -->
            <div class="lg:col-span-1">
                <div class="card p-5">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">توزيع المستفيدين حسب المحافظة</h3>
                    <div class="geo-chart-container">
                        <canvas id="geoDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Professional Color Palette
        const PALETTE = {
            green: '#008a4c', // From Solidarity Logo
            yellow: '#f9a825', // From Solidarity Logo
            darkText: '#333333',
            blue: '#2e58a6',   // From Dynamics 365 Logo
            purple: '#622f92', // From Dynamics 365 Logo
            red: '#d9534f',
            lightGrey: '#f4f7f9',
            grey: '#5a6e82'
        };

        // Data for charts
        const aidTypeData = {
            labels: ['فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو'],
            datasets: [{
                label: 'مساعدات نقدية (مليون ج.م)',
                data: [1.8, 2.1, 2.5, 2.3, 2.8, 3.1],
                backgroundColor: PALETTE.green,
                borderColor: PALETTE.green,
                borderWidth: 1,
                borderRadius: 5,
            }, {
                label: 'مساعدات عينية (ألف وحدة)',
                data: [5.2, 8.5, 6.1, 5.8, 7.2, 3.1],
                backgroundColor: PALETTE.blue,
                borderColor: PALETTE.blue,
                borderWidth: 1,
                borderRadius: 5,
            }]
        };

        const fileStatusData = {
            labels: ['مقبول', 'تحت البحث', 'جاري استيفاء الأوراق', 'مرفوض'],
            datasets: [{
                label: 'حالة الملفات',
                data: [7500, 2500, 1250, 1200],
                backgroundColor: [PALETTE.green, PALETTE.yellow, PALETTE.blue, PALETTE.red],
                hoverOffset: 4,
                borderColor: '#fff',
                borderWidth: 4,
            }]
        };

        const beneficiaryStatusData = {
            labels: ['متردد', 'جديد', 'متردد جديد'],
            datasets: [{
                label: 'حالة المستفيدين',
                data: [6225, 4980, 1245],
                backgroundColor: [PALETTE.purple, PALETTE.green, PALETTE.blue],
                hoverOffset: 4,
                borderColor: '#fff',
                borderWidth: 4,
            }]
        };

        const geoDistributionData = {
            labels: ['القاهرة', 'الجيزة', 'الشرقية', 'الدقهلية', 'البحيرة', 'الغربية', 'المنوفية', 'أسيوط', 'سوهاج', 'قنا', 'المنيا', 'كفر الشيخ', 'الفيوم', 'بني سويف', 'أسوان', 'الإسماعيلية', 'دمياط', 'بورسعيد', 'السويس', 'مطروح', 'البحر الأحمر', 'الوادي الجديد', 'شمال سيناء', 'جنوب سيناء'],
            datasets: [{
                label: 'عدد المستفيدين',
                data: [4500, 3800, 3200, 2800, 2500, 2200, 1800, 1600, 1400, 1200, 1100, 1000, 900, 800, 700, 600, 500, 400, 300, 250, 200, 150, 100, 50],
                backgroundColor: PALETTE.yellow,
                borderColor: '#d48f21',
                borderWidth: 1,
                borderRadius: 3,
            }]
        };

        // Chart rendering
        window.onload = function() {
            // Set current financial year in the header
            const date = new Date();
            const year = date.getFullYear();
            const month = date.getMonth(); // 0-indexed (0 for January, 6 for July)
            let financialYear;
            if (month >= 6) { // July or later
                financialYear = `${year}/${year + 1}`;
            } else { // Before July
                financialYear = `${year - 1}/${year}`;
            }
            document.getElementById('financial-year').textContent = financialYear;
            
            Chart.defaults.font.family = "'Cairo', sans-serif";
            Chart.defaults.font.weight = '600';

            const barChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { grid: { drawBorder: false }, ticks: { font: { size: 12 } } },
                    x: { grid: { display: false }, ticks: { font: { size: 12 } } }
                },
                plugins: {
                    legend: { position: 'bottom', labels: { usePointStyle: true, pointStyle: 'rectRounded', font: { size: 14 } } }
                }
            };
            
            const doughnutOptions = {
                 responsive: true,
                 maintainAspectRatio: false,
                 cutout: '70%',
                 plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { usePointStyle: true, pointStyle: 'rectRounded', font: { size: 14 } }
                    }
                }
            };
            
            const geoChartOptions = {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { grid: { display: false }, ticks: { font: { size: 11 } } },
                    x: { grid: { drawBorder: false }, ticks: { font: { size: 12 } } }
                },
                plugins: {
                    legend: { display: false }
                }
            };

            new Chart(document.getElementById('aidTypeChart'), { type: 'bar', data: aidTypeData, options: barChartOptions });
            new Chart(document.getElementById('fileStatusChart'), { type: 'doughnut', data: fileStatusData, options: doughnutOptions });
            new Chart(document.getElementById('beneficiaryStatusChart'), { type: 'doughnut', data: beneficiaryStatusData, options: doughnutOptions });
            new Chart(document.getElementById('geoDistributionChart'), { type: 'bar', data: geoDistributionData, options: geoChartOptions });
        };
    </script>
</body>
</html>
